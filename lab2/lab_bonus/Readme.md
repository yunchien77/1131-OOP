# Lab 02

> 在本次 Lab 你會重新使用組合與介面的方式，製作一款似 Pacman 的遊戲。
>
## 大綱
- 需求
- 說明
- 遊戲玩法
- 環境架設


## 需求
- 使用組合與介面的方式完成實驗
- 使用一次或多次 operator overloading。
- 符合題目敘述中所描述的**怪物行為模式**
- 符合遊戲獲勝與遊戲失敗的規則


## 說明

此次你可以向助教要求被挖空過的專案撰寫，或者自行重新規劃一個架構。以下題目會盡可能地清楚敘述 Lab02 的架構，如果對於題目有任何疑問，都可以寫信到助教信箱。

> Email: t111590009@ntut.org.tw.

## 遊戲玩法

### 遊戲流程
- 步驟：
    1. 渲染初始地圖與遊戲物件
    2. 輸入字元，如 `w`, `s`, `a`, `d` 代表玩家移動方向，`c` 代表行為模式切換為追逐，`x` 代表行為模式切換為散開。
    3. 判斷遊戲物件間，是否產生交互如怪物吃掉玩家、玩家吃掉點數等。並持續進行該流程直至遊戲結束。
- 勝利條件：將地圖所有的點數，也就是地圖中存在的所有 `d` 都被玩家吃完，則遊戲勝利。
- 失敗條件：任何一隻存在於地圖上的怪物觸碰到玩家一次，則遊戲失敗。


### 地圖
以下為此實驗的初次運行的樣態，其中 `B`, `I`, `N`, `C` 分別代表怪物 `Blinky`, `Inky`, `Pinky`, `Clyde`。`P` 代表玩家，`d` 代表點數。

如果四個怪物觸碰到玩家，也就是與玩家共同存在於同一格子，為怪物會吃掉玩家，則遊戲失敗。

如果玩家與點數共同存在於同一格子，為玩家會吃掉點數，若點數都被玩家吃完（地圖上都已不存在任何的點數時），則遊戲獲勝。

每一格地圖大小為五個字元，其中前後兩個字元為空格，若該格子有遊戲物件存在，則中間的一個字元為物件名稱，否則空格。

地圖長寬各為 `12*12` 單位格。遊戲物件不能超出此範圍。
```txt
|  I  |     |     |     |     |     |     |     |     |     |     |  C  |
|     |     |     |     |     |     |     |     |     |     |     |     |
|     |     |     |     |     |     |     |     |     |  d  |     |     |
|     |     |  d  |     |     |     |     |     |     |     |     |     |
|     |     |     |     |     |  d  |     |  P  |     |     |     |     |
|     |     |     |     |     |     |     |     |     |     |     |     |
|     |     |     |     |     |     |     |     |     |     |     |     |
|     |     |     |     |     |     |     |     |     |     |     |     |
|     |     |     |     |     |     |     |     |  d  |     |     |     |
|     |     |     |     |     |     |     |     |     |     |     |     |
|     |     |     |     |     |     |     |     |     |     |     |     |
|  B  |     |     |     |     |     |     |     |     |     |     |  N  |
next: ---------------------------------------------
```

若物件重疊時，則遊戲物件間，必須用 `/` 間格。如：`d` 和 `I` 遊戲物件存在於同一格，則合併顯示為 `d/I`。
```txt
|     |     |     |     |     |     |     |     |     |     |     |     |
|     |     |     |     |     |     |     |     |     |     |     |     |
|     |     |     |     |     |     |  N  |     |     |     |     |     |
|     |     |     |     |     |     |     |     |     |     |     |     |
|     |     |     |     |     |     |     |     |     |     |     |     |
|     |     |     |     |     |  B  |     |     |     |     |     |     |
|     |     |     |     |     |     |     |     |     |     |     |     |
|     |     |     |     |     |     |     |     |  P  |     |     |     |
|     |     |     |     |     |     |     |     | d/I |     |     |     |
|     |     |     |     |     |     |     |     |     |     |     |     |
|     |     |     |     |     |     |     |     |     |     |     |     |
|     |     |     |     |     |     |     |     |     |     |     |  C  |
next: ---------------------------------------------
```

### 座標
- 地圖的 X 軸為自左而右。地圖的 Y 軸為自下而上，地圖左下角為 `x=0, y=0`。
- 地圖上存在於四個點數的初始坐標為：`x=2, y=8`, `x=9, y=9`, `x=8, y=3`, `x=5, y=7`。
- Blinky 的初始位置：`x=0, y=0`
- Inky 的初始位置：`x=0, y=11`
- Pinky 的初始位置：`x=11, y=0`
- Clyde 的初始位置：`x=11, y=11`


## 怪物行為模式

怪物共有四個，分別為 `Blinky`, `Inky`, `Pinky`, `Clyde`。行為模式為兩種，分別為追逐與散開，以下為他們各自得移動模式。所有怪物初始的行為模式皆為追逐。

### 行為模式：追逐
在追逐的行為模式底下，所有的怪物都會參考玩家的位置做移動。且怪物的 X 軸與 Y 軸的移動方向會分開探討。
- Blinky
    - 該怪物會朝玩家最近的方向移動。
    - 如：玩家移動完的位置為 `x=3, y=3`，怪物當前位置為 `x=3, y=5`。則怪物移動軌跡在 X 軸上保持不變，Y 軸減一。
    - 如：玩家移動完的位置為 `x=4, y=4`，怪物當前位置為 `x=5, y=5`。則怪物移動軌跡在 X 軸減一，Y 軸減一。
- Inky
    - 該怪物將不斷朝目標點移動。目標點的計算方式為 `玩家座標 + (玩家座標 - 怪物座標)`。
    - 如：玩家移動完的位置為 `x=3, y=3`，怪物當前位置為 `x=3, y=5`。則怪物移動軌跡在 X 軸上保持不變，Y 軸加一。
- Pinky
    - 該怪物將不斷朝目標點移動。目標點的計算方式為 X 軸： `玩家座標 + 4`，Y 軸：`玩家座標 + 0`。
    - 如：玩家移動完的位置為 `x=3, y=3`，怪物當前位置為 `x=4, y=4`。則怪物移動軌跡在 X 軸加一，Y 軸減一。
- Clyde
    - 如果玩家出現在以該怪物為中心範圍前後左右各延伸四格的矩形範圍內，則朝玩家最近的方向移動。
    - 如：玩家移動完的位置為 `x=3, y=3`，該怪物當前位置為 `x=3, y=5`。則該怪物移動軌跡在 X 軸上保持不變，Y 軸減一。
    - 如：玩家移動完的位置為 `x=4, y=4`，該怪物當前位置為 `x=5, y=5`。則五怪物移動軌跡在 X 軸減一，Y 軸減一。
    - 如果玩家並不出現在以此怪物為中心的範圍內，則 X, Y 軸各隨機移動 `-1`, `0`, `1` 單位距離。

### 行為模式：散開
在散開的行為模式底下，所有的怪物都會以瞬移的方式回到初始位置，如果持續為散開的行為模式，則怪物持續待命於初始位置。
- Blinky
    - 初始位置：`x=0, y=0`
- Inky
    - 初始位置：`x=11, y=11`
- Pinky
    - 初始位置：`x=0, y=11`
- Clyde
    - 初始位置：`x=11, y=0`

## 額外任務
增加除點數外的遊戲物件，稱為櫻桃，代號為 `X`。且遊戲獲勝條件改為**如果地圖上存在的所有點數以及地圖上存在的所有櫻桃都被吃光**，則遊戲獲勝。

櫻桃位置可自行決定，數量為三。

## 架構參考

以下成爲 UML 的表達方式，其為標準答案的部分架構，以供學生參考。

### 位置

位置主要由兩個屬性，x 和 y。其中 X 軸為自上而下。地圖的 Y 軸為自左而右，且重載了等號比較運算子。
![GamePosition](https://hackmd.io/_uploads/HkmS2hMS1l.svg)

### 怪物

- Move 方法為每一個怪物根據不同的行為模式擁有不同的實作。
- SetState 方法主要用於設定怪物的行為模式為哪種狀態。
  ![Monster (1)](https://hackmd.io/_uploads/SJuVPeDSJl.svg)


### 行為模式

- Behaior 方法，所有的怪物行為模式的實作都撰寫至裡面。
  ![coding lab 03-3](https://hackmd.io/_uploads/BkIxJaGSyx.svg)

## 環境
以下為參考項不列入評分標準內。

由於不斷觀察怪物的行為模式非常地煩躁，所以你可以嘗試撰寫 unit test 來達成測試是否怪物行為正常？

在 `test` 有一個檔案叫 `ut_GamePosition`，可以觀察裡面的實作。

必要：
- `#include<gtest/gtest.h>`
- `TEST(Gameobject_system_test, 測試函數名稱) {......}`
- `EXPECT_EQ(lhs, rhs);`，左邊值和右邊值是否相同。
```cpp
#include <gtest/gtest.h>
#include "Object/GameObject.hpp"

TEST(Gameobject_system_test, test_01) {
    Object::GamePosition pos = {0 ,0};

    EXPECT_EQ(pos.x, 0);
    EXPECT_EQ(pos.y, 0);
}
```

### CMake Target
當你可以使用 CMake 編譯完，會發現在 `build` 或者 `cmake-build-debug` 資料夾發現兩個執行檔 `OOLAB` 和 `ut_all`。

- OOPLAB：運行遊戲本體。
- ut_all：運行測試腳本。

### VScode
如果你想要使用 VScode 切換編譯目標可以使用
1. `MacOS: command + Shift + p`
2. 輸入 `cmake:build target`
3. 輸入執行檔，`OOPLAB` 或者 `ut_all`

![Screenshot 2024-12-20 at 9.33.37 PM](https://hackmd.io/_uploads/B1oLzxXHyl.png)

### Clion

在 Clion，建構 CMake 完成後，可以點選視窗的右上角的下拉選單，選取 `OOPLAB` 或者 `ut_all`
![image](https://hackmd.io/_uploads/HJjmQgmHkx.png)



